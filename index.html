<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Hyper Stimulator</title>
<style>
  body {
    margin: 0; padding: 0; height: 100vh;
    background: #000; color: #fff;
    font-family: 'Arial Black', sans-serif;
    overflow: hidden; touch-action: none; /* ブラウザのデフォルトスワイプを無効化 */
  }
  #app {
    height: 100%; display: flex;
    justify-content: center; align-items: center;
    position: relative; overflow: hidden;
  }
  #count {
    font-size: 80px; font-weight: 900;
    z-index: 10; user-select: none;
    text-shadow: 0 0 20px rgba(255,255,255,0.5);
  }
  .particle {
    position: absolute; pointer-events: none;
    border-radius: 50%; z-index: 5;
  }
  #msg {
    position: absolute; top: 20%; width: 100%;
    text-align: center; font-size: 24px;
    font-style: italic; opacity: 0; z-index: 15;
  }
  /* ジャックポット演出用 */
  @keyframes shake {
    0% { transform: translate(0,0); }
    25% { transform: translate(5px,5px) rotate(5deg); }
    50% { transform: translate(-5px,-5px) rotate(-5deg); }
    75% { transform: translate(5px,-5px) rotate(5deg); }
    100% { transform: translate(0,0); }
  }
  .jackpot-mode { animation: shake 0.1s infinite; background: #ff00ff !important; }
</style>
</head>
<body>

<div id="app">
  <div id="msg">JACKPOT!!</div>
  <div id="count">0</div>
</div>

<script>
let count = 0;
const countEl = document.getElementById("count");
const appEl = document.getElementById("app");
const msgEl = document.getElementById("msg");

// パーティクル生成関数
function createParticle(x, y, color, isBig = false) {
  const p = document.createElement("div");
  p.className = "particle";
  const size = isBig ? Math.random() * 50 + 20 : Math.random() * 10 + 5;
  p.style.width = `${size}px`;
  p.style.height = `${size}px`;
  p.style.background = color;
  p.style.left = `${x}px`;
  p.style.top = `${y}px`;
  appEl.appendChild(p);

  const angle = Math.random() * Math.PI * 2;
  const velocity = isBig ? Math.random() * 20 + 10 : Math.random() * 10 + 5;
  const vx = Math.cos(angle) * velocity;
  const vy = Math.sin(angle) * velocity;

  p.animate([
    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
    { transform: `translate(${vx * 50}px, ${vy * 50}px) scale(0)`, opacity: 0 }
  ], { duration: 1000, easing: 'cubic-bezier(0, .9, .57, 1)' }).onfinish = () => p.remove();
}

function triggerEffect(e) {
  count++;
  countEl.textContent = count;
  
  const x = e.clientX || (e.changedTouches ? e.changedTouches[0].clientX : window.innerWidth/2);
  const y = e.clientY || (e.changedTouches ? e.changedTouches[0].clientY : window.innerHeight/2);
  
  const rand = Math.random();

  // 1. 【超大当たり】1%の確率で画面が狂う
  if (rand < 0.01) {
    document.body.classList.add('jackpot-mode');
    msgEl.style.opacity = 1;
    for(let i=0; i<50; i++) createParticle(x, y, `hsl(${Math.random()*360}, 100%, 50%)`, true);
    if(navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 300]);
    
    setTimeout(() => {
      document.body.classList.remove('jackpot-mode');
      msgEl.style.opacity = 0;
    }, 1000);

  // 2. 【中当たり】10%の確率でスロー＆拡大
  } else if (rand < 0.15) {
    countEl.animate([
      { transform: 'scale(1)', color: '#fff' },
      { transform: 'scale(5)', color: '#0ff' },
      { transform: 'scale(1)', color: '#fff' }
    ], { duration: 300 });
    for(let i=0; i<20; i++) createParticle(x, y, '#0ff');
    if(navigator.vibrate) navigator.vibrate(40);

  // 3. 【通常】
  } else {
    for(let i=0; i<5; i++) createParticle(x, y, '#555');
    if(navigator.vibrate) navigator.vibrate(10);
  }
}

// すべての入力をキャッチ（タップもスワイプ終了時も同様のトリガー）
appEl.addEventListener("pointerup", (e) => {
  triggerEffect(e);
});

// マウスホイールや二本指操作での意図しないズームを防止
document.addEventListener('touchstart', (e) => {
  if (e.touches.length > 1) e.preventDefault();
}, { passive: false });
</script>
</body>
</html>
